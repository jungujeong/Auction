<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>중고경매</title>
    <link rel="stylesheet" href="/auction/css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="container">
            <a href="/auction/" class="logo">중고경매</a>
            <nav>
                <ul>
                    <li><a href="/auction/">홈</a></li>
                    <li><a href="/auction/items.html">경매 목록</a></li>
                    <li><a href="/auction/register-item.html">물건 등록</a></li>
                    <li id="loginLink"><a href="/auction/login.html">로그인</a></li>
                    <li id="signupLink"><a href="/auction/signup.html">회원가입</a></li>
                    <li id="userInfo" style="display: none;"><span id="usernameDisplay"></span></li>
                    <li id="logoutLink" style="display: none;"><a href="#" onclick="logout()">로그아웃</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- 히어로 섹션 -->
    <div class="hero-section">
        <div class="container">
            <h1>중고경매</h1>
            <p>실시간 경매로 합리적인 가격에</p>
            <div class="hero-buttons">
                <a href="/auction/items.html" class="btn btn-primary">경매 보기</a>
                <a href="/auction/register-item.html" class="btn btn-success">판매하기</a>
            </div>
        </div>
    </div>

    <!-- 참여 가능한 경매 목록 -->
    <div class="container">
        <h2 class="section-title">참여 가능한 경매</h2>
        <div class="grid" id="recentItems">
            <!-- JavaScript로 동적 로드 -->
            <p class="text-center">경매 상품을 불러오는 중...</p>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 중고경매</p>
        </div>
    </footer>

    <script>
        // 페이지 로드 시 로그인 상태 확인
        window.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const username = localStorage.getItem('username');

            if (token && username) {
                // 로그인 상태
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('signupLink').style.display = 'none';
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('logoutLink').style.display = 'block';
                document.getElementById('usernameDisplay').textContent = username + '님';
            } else {
                // 로그아웃 상태
                document.getElementById('loginLink').style.display = 'block';
                document.getElementById('signupLink').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('logoutLink').style.display = 'none';
            }
        });

        // 로그아웃 함수
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            alert('로그아웃 되었습니다.');
            window.location.reload();
        }

        // 경매 목록 불러오기
        async function loadRecentItems() {
            try {
                const response = await fetch('/auction/api/items/active');

                if (response.ok) {
                    const items = await response.json();
                    displayItems(items);
                } else {
                    document.getElementById('recentItems').innerHTML =
                        '<p class="text-center">경매 상품을 불러올 수 없습니다.</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('recentItems').innerHTML =
                    '<p class="text-center">오류가 발생했습니다.</p>';
            }
        }

        // 경매 상품 카드 표시
        function displayItems(items) {
            const container = document.getElementById('recentItems');

            if (items.length === 0) {
                container.innerHTML = '<p class="text-center">참여 가능한 경매가 없습니다.</p>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="card">
                    <div class="item-image" style="background: #eee; height: 200px; display: flex; align-items: center; justify-content: center;">
                        ${item.imageUrl ?
                            `<img src="${item.imageUrl}" alt="${item.title}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            '<p>이미지 없음</p>'}
                    </div>
                    <h3>${item.title}</h3>
                    <p class="item-price">시작가: ${formatPrice(item.startPrice)}원</p>
                    <p class="item-info">판매자: ${item.sellerName}</p>
                    <a href="/auction/auction-detail.html?id=${item.id}" class="btn btn-primary" style="width: 100%; text-align: center; display: block;">참여 신청</a>
                </div>
            `).join('');
        }

        // 가격 포맷팅
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // 페이지 로드 시 경매 목록 불러오기
        window.addEventListener('DOMContentLoaded', loadRecentItems);
    </script>
</body>
</html>
